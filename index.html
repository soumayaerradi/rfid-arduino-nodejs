<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Read RFID</title>
		<style>
			p {
				font-family: 'Courier New', Courier, monospace;
			}
			h2 {
				font-family: 'Courier New', Courier, monospace;
			}
			button {
				font-family: 'Courier New', Courier, monospace;
				font-size: 15px;
				margin-right: 50px;
			}
			label {
				font-family: 'Courier New', Courier, monospace;
				font-size: 16px;
				font-weight: bold;
			}
			textarea {
				font-family: 'Courier New', Courier, monospace;
				font-size: 18px;
			}
			th,td {
				width: 200px;
			}
		</style>
	</head>
	<body>
		<label for="arduino-serial">Arduino Streaming Data:</label><br>
		<p>Press Start Data to get data from Arduino.</p>
		<p>To make it stop, press Stop Data.</p>
		<textarea id="arduino-serial" cols="50" rows="10"></textarea><br>
		<button onclick="stopData()">Stop Data</button>
		<button onclick="startData()">Start Data</button>
		<button onclick="clearData()">Clear Data</button>

		<table>
            <th>id</th>
            <th>Code</th>
            <th>Date</th>
            <tbody id="table"></tbody>
        </table>
		<script src="/socket.io/socket.io.js"></script>
  		<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
		<script>
			var socket = io.connect('http://localhost:3000');
			var txtarea = document.getElementById('arduino-serial');
			var table = document.getElementById('table');
			function stopData() {
				socket.off('data');
			}
			function startData() {
				socket.on('data', function(elem) {
					console.log("data received: ", elem);
					table.innerHTML = "";
					elem.forEach(element => {
						var table_row  = document.createElement('tr');
						table.appendChild(table_row);
						var id = document.createElement('td');
						id.innerText = element.id;
						var code = document.createElement('td');
						code.innerText = element.code;
						var date = document.createElement('td');
						date.innerText = element.date;
						table_row.appendChild(id);
						table_row.appendChild(code);
						table_row.appendChild(date);
					});
					if (!!elem.length) {
						txtarea.value = txtarea.value + "-> RFID: " + elem[elem.length - 1].code + " DATE: " + elem[elem.length - 1].date + "\n";
						txtarea.scrollTop = txtarea.scrollHeight;
						console.log("TXT: " + txtarea.value);
					}
				});
			}
			function clearData() {
				txtarea.value = "";
			}
		</script>
	</body>
</html>
